<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Zeynep'e Ã–zel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#ffffff;
    --text:#0b1c3d;
    --accent:#0b1c3d;
}

body.night{
    --bg:#0b1c3d;
    --text:#ffffff;
    --accent:#ffffff;
}

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins', sans-serif;
}

body{
    background:var(--bg);
    color:var(--text);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
    transition:0.8s;
}

/* === MUM === */
#candleBox{text-align:center; transition: 0.5s;}
#candle{
    width:40px;height:120px;
    background:var(--accent);
    border-radius:10px;
    margin:auto;position:relative;
}
#flame{
    width:26px;height:26px;
    background:#ffcc80;
    border-radius:50%;
    position:absolute;top:-22px;left:7px;
    animation:flicker .25s infinite;
    box-shadow:0 0 15px #ffcc80;
}
@keyframes flicker{
    50%{transform:scale(.85)}
}
#instruction{margin-top:16px;opacity:.8}

/* === SAHNE === */
#main{
    display:none;
    position:absolute;
    inset:0;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index: 10;
}
#quote{
    font-size:24px;
    margin-bottom:20px;
    opacity:0;
    transition:1s;
    text-align: center;
}
#nameContainer{
    font-size:64px;
    font-weight:700;
    min-height:80px;
    color: var(--accent);
}

/* === EFEKTLER === */
.heart{
    position:absolute;
    font-size:24px;
    color: #e74c3c;
    z-index: 5;
    animation:float 4s linear forwards;
}
@keyframes float{
    0%{transform:translateY(0) scale(1); opacity:1}
    100%{transform:translateY(-100vh) scale(1.5); opacity:0}
}

.confetti{
    position:absolute;
    width:10px;height:10px;
    background:var(--accent);
    z-index: 5;
    animation:confettiAnim 4s linear forwards;
}
@keyframes confettiAnim{
    to{transform:translateY(110vh) rotate(720deg);opacity:0}
}

/* === BUTONLAR === */
.btn-group { margin-top: 30px; display: flex; gap: 10px; }
button{
    background:none;
    border:1px solid var(--accent);
    padding:10px 20px;
    border-radius:25px;
    color:var(--accent);
    cursor:pointer;
    opacity:0;
    pointer-events: none;
    transition:.5s;
}
button.show{opacity:1; pointer-events: auto;}

.fadeOut{opacity: 0; pointer-events: none;}
</style>
</head>

<body>

<div id="candleBox">
    <div id="candle"><div id="flame"></div></div>
    <div id="instruction">Muma Ã¼fle âœ¨</div>
</div>

<div id="main">
    <div id="quote">Bu kalp sadece sana Ã¼flendi.</div>
    <div id="nameContainer"></div>
    <div class="btn-group">
        <button id="resetBtn" onclick="location.reload()">Tekrarla</button>
        <button id="modeBtn" onclick="toggleNight()">Gece Modu</button>
    </div>
</div>

<audio id="music" src="music.mp3" preload="auto"></audio>

<script>
let blown = false;
let vol = 0.1;
const music = document.getElementById("music");
const nameContainer = document.getElementById("nameContainer");
const quote = document.getElementById("quote");
const main = document.getElementById("main");
const candleBox = document.getElementById("candleBox");

/* === ÃœFLEME ALGILAMA === */
navigator.mediaDevices.getUserMedia({audio:true}).then(stream => {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const mic = ctx.createMediaStreamSource(stream);
    const analyser = ctx.createAnalyser();
    mic.connect(analyser);
    analyser.fftSize = 256;
    const data = new Uint8Array(analyser.frequencyBinCount);

    function detect(){
        analyser.getByteFrequencyData(data);
        let sum = 0;
        for(let i=0; i<data.length; i++) sum += data[i];
        let average = sum / data.length;

        if(average > 55 && !blown){ // Hassasiyet ayarÄ± (55)
            blown = true;
            startScene();
        }
        if(!blown) requestAnimationFrame(detect);
    }
    detect();
}).catch(err => {
    console.log("Mikrofon eriÅŸimi reddedildi, tÄ±klama ile devam ediliyor.");
    document.body.onclick = () => { if(!blown) { blown=true; startScene(); }};
});

/* === SAHNE BAÅžLAT === */
function startScene(){
    candleBox.classList.add("fadeOut");
    
    setTimeout(() => {
        candleBox.style.display = "none";
        main.style.display = "flex";
        
        // MÃ¼ziÄŸi BaÅŸlat
        music.currentTime = 60; // 1. dakikadan baÅŸlar
        music.volume = vol;
        music.play().catch(e => console.log("MÃ¼zik baÅŸlatÄ±lamadÄ±:", e));

        // Ã–nce SÃ¶z Ã‡Ä±ksÄ±n
        setTimeout(() => {
            quote.style.opacity = 1;
            // SÃ¶zden 1.5 saniye sonra isim baÅŸlasÄ±n
            setTimeout(() => {
                typeWriter("Zeynep");
            }, 1500);
        }, 500);
    }, 1000);
}

/* === HARF HARF YAZDIRMA === */
function typeWriter(txt){
    let i = 0;
    nameContainer.textContent = ""; 
    const interval = setInterval(() => {
        nameContainer.textContent += txt[i];
        i++;
        if(i === txt.length){
            clearInterval(interval);
            finishAnimation();
        }
    }, 300); // Harf hÄ±zÄ±
}

function finishAnimation(){
    boostMusic();
    startHearts();
    startConfetti();
    
    // ButonlarÄ± gÃ¶ster
    setTimeout(() => {
        document.getElementById("resetBtn").classList.add("show");
        document.getElementById("modeBtn").classList.add("show");
    }, 2000);
}

/* === EFEKTLER === */
function startHearts(){
    setInterval(() => {
        if(!blown) return;
        const h = document.createElement("div");
        h.className = "heart";
        h.innerHTML = Math.random() > 0.7 ? "â¤ï¸" : "ðŸ’–";
        h.style.left = Math.random() * 100 + "vw";
        h.style.top = "100vh";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 4000);
    }, 400);
}

function startConfetti(){
    for(let i=0; i<80; i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.top = "-20px";
        c.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 60%)`;
        c.style.animationDelay = Math.random() * 3 + "s";
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 5000);
    }
}

function boostMusic(){
    const b = setInterval(() => {
        if(vol < 0.8){ 
            vol += 0.05; 
            if(vol > 1) vol = 1;
            music.volume = vol;
        } else {
            clearInterval(b);
        }
    }, 200);
}

function toggleNight(){
    document.body.classList.toggle("night");
}
</script>

</body>
</html>
