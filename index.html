<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Zeynep'e Ã–zel</title>
<style>
    :root { --bg:#ffffff; --text:#0b1c3d; --accent:#0b1c3d; }
    body.night { --bg:#0b1c3d; --text:#ffffff; --accent:#ffffff; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:sans-serif; }
    body { background:var(--bg); color:var(--text); height:100vh; display:flex; justify-content:center; align-items:center; overflow:hidden; transition:0.8s; touch-action: manipulation; }
    
    #candleBox { text-align:center; transition: 0.5s; }
    #candle { width:40px; height:100px; background:var(--accent); border-radius:8px; margin:auto; position:relative; }
    #flame { width:20px; height:20px; background:#ffaa00; border-radius:50%; position:absolute; top:-18px; left:10px; animation: flicker .2s infinite; box-shadow:0 0 15px #ffaa00; }
    @keyframes flicker { 50% { transform: scale(0.9); opacity: 0.8; } }
    
    #main { display:none; flex-direction:column; align-items:center; width: 100%; position: absolute; text-align: center; }
    #quote { font-size:22px; opacity:0; transition:1.5s; margin-bottom:15px; padding: 0 20px; font-style: italic; }
    #finalText { font-size:32px; font-weight:bold; color: var(--accent); padding: 0 20px; line-height: 1.4; }
    
    .btn-group { margin-top: 40px; display: flex; gap: 10px; opacity: 0; transition: 1s; visibility: hidden; }
    .btn-group.show { opacity: 1; visibility: visible; }
    button { background:none; border:1px solid var(--accent); padding:10px 20px; border-radius:25px; color:var(--accent); font-size: 14px; cursor: pointer; }
    
    .heart { position:absolute; color:red; animation: fly 4s linear forwards; pointer-events:none; z-index:100; }
    @keyframes fly { 0% { transform:translateY(0) scale(1); opacity:1; } 100% { transform:translateY(-100vh) scale(1.5); opacity:0; } }
</style>
</head>
<body>

<div id="candleBox" onclick="startScene()">
    <div id="candle"><div id="flame"></div></div>
    <p style="margin-top:15px; font-size: 14px; opacity: 0.6;">Muma Ã¼fle veya dokun âœ¨</p>
</div>

<div id="main">
    <div id="quote">Bu kalp sadece sana Ã¼flendi.</div>
    <div id="finalText"></div>
    <div id="btns" class="btn-group">
        <button onclick="location.reload()">Tekrarla</button>
        <button onclick="document.body.classList.toggle('night')">Gece Modu</button>
    </div>
</div>

<audio id="music" src="music.mp3"></audio>

<script>
let blown = false;
const music = document.getElementById("music");
const quote = document.getElementById("quote");
const finalText = document.getElementById("finalText");

// MÄ°KROFON DÄ°NLEME
navigator.mediaDevices.getUserMedia({audio:true}).then(stream => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    source.connect(analyser);
    const data = new Uint8Array(analyser.frequencyBinCount);
    
    function check() {
        analyser.getByteFrequencyData(data);
        let volume = data.reduce((a, b) => a + b) / data.length;
        if (volume > 45 && !blown) startScene(); 
        if (!blown) requestAnimationFrame(check);
    }
    check();
}).catch(() => console.log("Dokunma modu aktif."));

function startScene() {
    if(blown) return;
    blown = true;
    
    // 1. Mum sÃ¶ner
    document.getElementById("candleBox").style.opacity = "0";
    
    setTimeout(() => {
        document.getElementById("candleBox").style.display = "none";
        document.getElementById("main").style.display = "flex";
        
        // MÃ¼zik ayarlarÄ±
        music.volume = 0.3;
        music.currentTime = 60;
        music.play().catch(() => {});

        // 2. Ä°lk sÃ¶z gÃ¶rÃ¼nÃ¼r
        setTimeout(() => {
            quote.style.opacity = "1";
            
            // 3. Ä°lk sÃ¶z 3 saniye durur, sonra yavaÅŸÃ§a silinir
            setTimeout(() => {
                quote.style.opacity = "0";
                
                // 4. Silindikten sonra asÄ±l yazÄ± (Zeynep...) baÅŸlar
                setTimeout(() => {
                    quote.style.display = "none"; // AlanÄ± boÅŸalt
                    typeWriter("Zeynep seni Ã§ok seviyorum â¤ï¸");
                }, 1500); // Silinme animasyonu bitiÅŸi bekler
                
            }, 3000); // SÃ¶zÃ¼n ekranda kalma sÃ¼resi
        }, 500);
    }, 800);
}

function typeWriter(txt) {
    let i = 0;
    const timer = setInterval(() => {
        finalText.textContent += txt[i];
        i++;
        if (i === txt.length) {
            clearInterval(timer);
            finish();
        }
    }, 150); // YazÄ± hÄ±zÄ±
}

function finish() {
    // Ses yavaÅŸÃ§a yÃ¼kselir
    let vol = 0.3;
    const volInterval = setInterval(() => {
        if (vol < 0.8) { vol += 0.05; music.volume = vol; }
        else clearInterval(volInterval);
    }, 400);

    // Butonlar gÃ¶rÃ¼nÃ¼r
    document.getElementById("btns").classList.add("show");

    // Kalp yaÄŸmuru baÅŸlar
    setInterval(() => {
        const h = document.createElement("div");
        h.className = "heart";
        h.innerHTML = Math.random() > 0.5 ? "â¤ï¸" : "ðŸ’–";
        h.style.left = Math.random() * 100 + "vw";
        h.style.top = "90vh";
        h.style.fontSize = (Math.random() * 20 + 15) + "px";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 4000);
    }, 400);
}
</script>
</body>
</html>
