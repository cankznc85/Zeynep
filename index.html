<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Zeynep'e Özel</title>
<style>
    :root { --bg:#ffffff; --text:#0b1c3d; --accent:#0b1c3d; }
    body.night { --bg:#0b1c3d; --text:#ffffff; --accent:#ffffff; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:sans-serif; }
    body { background:var(--bg); color:var(--text); height:100vh; display:flex; justify-content:center; align-items:center; overflow:hidden; transition:0.8s; touch-action: manipulation; }
    
    #candleBox { text-align:center; transition: 0.5s; }
    #candle { width:40px; height:100px; background:var(--accent); border-radius:8px; margin:auto; position:relative; }
    #flame { width:20px; height:20px; background:#ffaa00; border-radius:50%; position:absolute; top:-18px; left:10px; animation: flicker .2s infinite; box-shadow:0 0 15px #ffaa00; }
    @keyframes flicker { 50% { transform: scale(0.9); opacity: 0.8; } }
    
    #main { display:none; flex-direction:column; align-items:center; width: 100%; position: absolute; }
    #quote { font-size:20px; opacity:0; transition:1.2s; margin-bottom:15px; text-align:center; padding: 0 10px; }
    #nameArea { font-size:50px; font-weight:bold; min-height:60px; color: var(--accent); }
    
    .btn-group { margin-top: 30px; display: flex; gap: 10px; opacity: 0; transition: 1s; }
    .btn-group.show { opacity: 1; }
    button { background:none; border:1px solid var(--accent); padding:8px 15px; border-radius:20px; color:var(--accent); font-size: 14px; }
    
    .heart { position:absolute; color:red; animation: fly 3s linear forwards; pointer-events:none; z-index:100; }
    @keyframes fly { from { transform:translateY(0); opacity:1; } to { transform:translateY(-100vh); opacity:0; } }
</style>
</head>
<body>

<div id="candleBox" onclick="startScene()">
    <div id="candle"><div id="flame"></div></div>
    <p style="margin-top:15px">Muma üfle (veya dokun) ✨</p>
</div>

<div id="main">
    <div id="quote">Bu kalp sadece sana üflendi.</div>
    <div id="nameArea"></div>
    <div id="btns" class="btn-group">
        <button onclick="location.reload()">Tekrarla</button>
        <button onclick="document.body.classList.toggle('night')">Gece Modu</button>
    </div>
</div>

<audio id="music" src="music.mp3"></audio>

<script>
let blown = false;
const music = document.getElementById("music");

// ÜFLEME ALGILAMA (Mobil için hassasiyet artırıldı)
navigator.mediaDevices.getUserMedia({audio:true}).then(stream => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    source.connect(analyser);
    const data = new Uint8Array(analyser.frequencyBinCount);
    
    function check() {
        analyser.getByteFrequencyData(data);
        let volume = data.reduce((a, b) => a + b) / data.length;
        if (volume > 45 && !blown) startScene(); 
        if (!blown) requestAnimationFrame(check);
    }
    check();
}).catch(() => {
    console.log("Mikrofon izni yok, dokunma aktif.");
});

function startScene() {
    if(blown) return;
    blown = true;
    
    // Mum sönme efekti
    document.getElementById("candleBox").style.opacity = "0";
    
    setTimeout(() => {
        document.getElementById("candleBox").style.display = "none";
        document.getElementById("main").style.display = "flex";
        
        // Müziği başlat
        music.volume = 0.2;
        music.currentTime = 60;
        music.play().catch(() => {});

        // 1. Söz görünür
        setTimeout(() => {
            document.getElementById("quote").style.opacity = "1";
            
            // 2. İsim yazılmaya başlar
            setTimeout(() => {
                const targetName = "Zeynep";
                let i = 0;
                const area = document.getElementById("nameArea");
                
                const timer = setInterval(() => {
                    area.textContent += targetName[i];
                    i++;
                    if (i === targetName.length) {
                        clearInterval(timer);
                        finish();
                    }
                }, 400); // Yazım hızı
            }, 1500);
        }, 500);
    }, 800);
}

function finish() {
    // Ses yükselt
    let vol = 0.2;
    const interval = setInterval(() => {
        if (vol < 0.9) { vol += 0.1; music.volume = vol; }
        else clearInterval(interval);
    }, 300);

    // Butonları göster
    document.getElementById("btns").classList.add("show");

    // Kalp yağmuru
    setInterval(() => {
        const h = document.createElement("div");
        h.className = "heart";
        h.innerHTML = "❤️";
        h.style.left = Math.random() * 100 + "vw";
        h.style.top = "90vh";
        h.style.fontSize = (Math.random() * 20 + 10) + "px";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 3000);
    }, 300);
}
</script>
</body>
</html>
